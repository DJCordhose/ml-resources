<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">

	<title>MAD 2023 - Architektur eines Machine Learning Services</title>

	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<!-- <link rel="stylesheet" href="reveal.js/dist/theme/black.css"> -->
	<link rel="stylesheet" href="reveal.js/dist/theme/white.css">

	<!-- Theme used for syntax highlighted code -->
	<!-- <link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css"> -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/zenburn.css">
	<style>
		.right-img {
			margin-left: 10px !important;
			float: right;
			height: 500px;
		}

		.todo:before {
			content: 'TODO: ';
		}

		.todo {
			color: red !important;
		}

		code span.line-number {
			color: lightcoral;
		}

		.reveal pre code {
			max-height: 1000px !important;
		}

		img {
			border: 0 !important;
			box-shadow: 0 0 0 0 !important;
			height: 450px;
		}

		.reveal {
			-ms-touch-action: auto !important;
			touch-action: auto !important;
		}

		.reveal h1,
		.reveal h2,
		.reveal h3,
		.reveal h4 {
			/* letter-spacing: 2px; */
			font-family: 'Calibri', sans-serif;
			/* font-family: 'Times New Roman', Times, serif; */
			/* font-weight: bold; */
			color: black;
			/* font-style: italic; */
			/* letter-spacing: -2px; */
			text-transform: none !important;
		}

		.reveal em {
			font-weight: bold;
		}

		.reveal section img {
			background: none;
		}

		.reveal img.with-border {
			border: 1px solid #586e75 !important;
			box-shadow: 3px 3px 1px rgba(0, 0, 0, 0.15) !important;
		}

		.reveal li {
			margin-bottom: 8px;
		}

		/* For li's that use FontAwesome icons as bullet-point */
		.reveal ul.fa-ul li {
			list-style-type: none;
		}

		.reveal {
			/* font-family: 'Work Sans', 'Calibri'; */
			font-family: 'Calibri';
			color: black !important;
			font-size: xx-large;
		}

		.container {
			display: flex;
		}

		.col img {
			height: auto;
		}

		.col,
		col-1 {
			flex: 1;
		}

		.col-2 {
			flex: 2;
		}

	/* https://intranet.openknowledge.de/plugins/servlet/mobile?contentId=18612939#content/view/18612939
      https://intranet.openknowledge.de/pages/viewpage.action?pageId=16157867
      https://openknowledgede.sharepoint.com/:p:/s/slides/EYWbMPz2ejhBprBrP8BYGxsBA3BrPNhDxJBrTXXvHi3-ZQ?e=jMZihi
       */
       body:after {
        content: url(img/ok/logo.png) ;
        position: fixed;
        bottom: 80px;
        left: -1080px;
        transform: scale(.06);
        height: 10px;
    }

	</style>

</head>

<body style="background-color: whitesmoke;">
	<div class="reveal">
		<div class="slides">
<!-- 
Workshop (3h)

Monday, June 19 2023
14:00 - 17:30

Architektur eines Machine Learning Services

Machine Learning (ML) ist kein Voodoo, sondern häufig eine von mehreren Optionen und ersetzt nur bestimmte Teile einer
klassischen Software.

In diesem Workshop werden wir anhand eines realistischen Beispiels einen Machine Learning Service konzeptionieren und
dabei die Vor- und Nachteile unterschiedlicher Machine Learning Ansätze im Vergleich zu klassischer Business Logik
untersuchen.

Im Anschluss werden wir den Service in ein typisches Enterprise Computing einbetten.

Wir werden uns auf einem architektonischen Level bewegen, daher ist kein Laptop notwendig. Es werden keine Kenntnis von
Machine Learning oder Prinzipien der Software-Architektur vorausgesetzt.

-->

<section data-markdown>
	<textarea data-template>
# Architektur eines Machine Learning Services

Hanna Lüschow, Oliver Zeigermann

https://mad-summit.de/architektur/architektur-eines-machine-learning-services/

Slides: https://bit.ly/mad-ml-2023

<!-- https://djcordhose.github.io/ml-resources/2023-mad.html -->

<img src="img/bit.ly_mad-ml-2023.png" style="height: 200px;">

</textarea>
</section>

<section data-markdown class="todo">
  <textarea data-template>
### Essence aufnehmen

* am Ende als Idee als Intro für den Kopf
* https://www.ivarjacobson.com/essence-explained-agile-tools
* https://cloud.oose.de/s/KMHTyfCT2PyqbNS

</textarea>
</section>

<section data-markdown>
  <textarea data-template>
### Wer ist Hanna

<img src='img/Hanna-Lueschow-6.jpg'>

<p>
<a target="_blank" href="mailto:hanna.lueschow@openknowledge.de">Hanna Lüschow</a>:
Dev@OPEN KNOWLEDGE
</p>    
</textarea>
</section>

<section data-markdown>
  <textarea data-template>
### Wer ist Olli

<img src='img/olli-opa.jpeg'>

<p>
<a target="_blank" href="mailto:oliver@zeigermann.de">Oliver Zeigermann</a>:
Blue Collar Architect(ML)
</p>    
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Stellt euch euren Nachbarn vor

### Wir diskutieren später mehr

Fragen:
* Was macht ihr?
* Was wisst ihr schon im Bereich DevOps oder MLOps (nichts ist absolute ok) 
* Was wollt ihr wissen?

_5 Minuten_

Mit Fremden sprechen macht glücklich: https://www.instagram.com/reel/CsHP-DOMdKl/?igshid=NzJjY2FjNWJiZg%3D%3D
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Olli		
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Our challenge for today: predicting risks

* We do architectural work for a highly innovative car insurance company.
* Unlike other insurance companies, we determine the rate based on the estimated number of accidents per customer.
* Objective: How many accidents will the potential customers have?

<img src='img/pixabay/accident-151668_1280.png' style="height: 230px">
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Information from domain expert / PM role

<img src='img/olli-opa.jpeg' style="height: 300px;">

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Context

_We can rely on data collected from people who have insurance_

* We have collected sets of data from existing customers
* Application data contains a set of features

</textarea>
</section>


<section data-markdown>
### Features to draw conclusions from

* driver
  * *training*: 0/1, whether the driver completed driver training
  * *age*: Age of the driver in years
* vehicle  
  * *emergency_braking*: 0/1, whether the vehicle has an emergency braking system 
  * *braking_distance*: Braking distance from speed 100
  * *power*: Power in KW
* *miles*: Annual mileage
* to predict
  * *risk_group*: Classification into group based on risk
</section>

<section data-markdown>
	<textarea data-template>
### Requirements for our solution

1. *Accuracy* - should have 80% or more cases correct
1. *Explainability* - we need to explain how we come to the conclusion
1. *Stability* - an updated version of the software must be possible and should not behave totally different
1. *Hackability* - it should be hard to find out how the software works to resist manipulation
1. *Resources* - should scale well and not use a lot of resources to run

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Metric: Accuracy

- Based on a defined test set
- For this test set you know the input and the supposedly correct output
- Supposing three groups: low risk, medium risk, high risk
- You feed your model with the input and get the predicted output
- What fraction of the decisions made were correct?
- This is called accuracy

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Stability

* people are the final target audience most of the time
* but people do not like the general idea of a redesign
  * things should not behave differently unless for a very good reason
  * this is also true for UX, compare to Spotify redesign: https://youtu.be/p4x6L9f5Us0?t=176
* why would someone with exactly the same properties receive a different risk score just because they applied at an earlier/later date/version of the model?   

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Hacking the system / Adversarial Attacks

<img src="img/hacking-the-system.png">

https://www.instagram.com/reel/CkQUhLov9_u/?igshid=MDJmNzVkMjY=
</textarea>
</section>
    

<section data-markdown>
	<textarea data-template>
# Hanna
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Information from technical experts / Dev role

<img src='img/Hanna-Lueschow-6.jpg' style="height: 300px;">
</textarea>
</section>
	
<section data-markdown>
	<textarea data-template>
### Options for business logic

<img src="img/architecture/logic.jpg">

</textarea>
</section>	


<section data-markdown>
	<textarea data-template>
## Classic Solution: Code

```
if training: 
    return LOW_RISK
if age < 30:
    if power > 130:
        return HIGH_RISK
    else:
        return MEDIUM_RISK
if age > 50:
    return HIGH_RISK
if emergency_braking:
    return LOW_RISK
if milage > 50:
    return HIGH_RISK
if milage > 30:
    return MEDIUM_RISK
# default
return LOW_RISK
```

if you want this maintainable, you can not make this too complex or too nested
</textarea>
</section>


<section data-markdown>
	<textarea data-template>
### There are options, though

<img src="exercise/solutions.png">

https://ml-playground.com

Notes:
a) Code mit echtem Code-Beispiel: Wenn tiefer nicht mehr Wartbar und von Hand schreibbar
b) Decision Tree
c) K-Nearest Neighbors
d) Deep Learning
	</textarea>
</section>


<section data-markdown>
	<textarea data-template>
## Hands-On: Choose a suitable solution

*Pair up in teams of at least two and at most four people*

1. Code or Data Driven
1. If data driven, which ML approach?
1. Ask experts if you need further information
1. Document your decision
1. Choose whatever form you see fit for documentation

### 45 Minutes
</textarea>
</section>
		
<section data-markdown style="font-size: x-large;">
	<textarea data-template>
# Overview for hands-on

<div class="container">
	<div class="col">

## Requirements for our solution

1. *Accuracy* - should have 80% or more cases correct
1. *Explainability* - we need to explain how we come to the conclusion
1. *Stability* - an updated version of the software must be possible and should not behave totally different
1. *Hackability* - it should be hard to find out how the software works to resist manipulation
1. *Resources* - should scale well and not use a lot of resources to run

	</div>
	<div class="col">
		
## Document
_Document your decision_
- Assumptions
- Compromises
- Inferred priorities
- etc.

Choose whatever form you see fit for documentation
			</div>

</div>

	</textarea>
</section>

<section data-markdown class="fragments">
	<textarea data-template>
# Break
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Olli
	</textarea>
</section>


<section data-markdown class="fragments">
	<textarea data-template>
### Reflection

1. What kind of documentation did you write?
   * Did you feel comfortable with the form chosen?
   * Did you really have a choice?
1. How did you feel wile making your decision?
   * Did you feel stressed? What stressed you out?
   * Did you feel up to the task of making a choice in the first place?
   * Who was lacking deeper technical insights?
   * Who wanted more emotional support?
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# But
## How is this related to software architecture?
</textarea>
</section>

<section data-markdown class="fragments">
### (Software) Architecture

* the important decisions, whatever they are
  * once taken they are often hard to change
  * often have to be made early in a project
  * require compromise
  * if being bad have the potential to make the project fail
* there always are important decisions
  * if you don't choose explicitly, there always is one implicit choice
* sources 
  * https://martinfowler.com/architecture
  * "The Rational Unified Process. An Introduction.“ Addison-Wesley 2004,  3rd Edition, Philippe Kruchten, chapter 5, p. 84 
  

_there are other definitions, but this is the definition we use today_


Notes:
- img/architecture/RUP_Definition.pdf
</section>

<section data-markdown>
	<textarea data-template>

<img src="img/twitter-crichardson-patterns.png">

https://twitter.com/crichardson/status/1653041898779467776
</textarea>
</section>

<section data-markdown class="fragments">
### Architectural Work

_under high uncertainty and imperfect information ..._
1. find areas of important decisions (often solely based on experience and gut feeling)
1. match
   * (partially contradicting and incomplete or even only implicit) requirements - given by domain expert role - with
   * (vague) properties of (a mostly arbitrary selection of) architectural patterns / frameworks - given by technical expert role
   * while inferring priorities (because no one wants to give them) by making assumptions
</section>

<section data-markdown>
	<textarea data-template>
### Some areas of important technical decisions in a business app

<img src="img/architecture/areas.jpg">

_We leave out the areas of people and administration for today (even though they are at least as important)_
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Today we deal with business logic

<img src="img/architecture/logic.jpg">

_Might not be obvious, but this can be an architectural decision_
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Why document?

1. Making things explicit
   * making sure proper reasoning has been done in the first place
   * provide a basis for discussion
1. Reference
   * something used by developer roles to actually make the software
   * for people coming back into the project at a later point
   * having your back
1. Requirements change or get more obvious and explicit over time - we can not look into the future
   * If this happens do we know what decision we took based on what perceived requirement and assumption?

_most of this gets invalidated when documentation is dishonest_   
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### What to document?

<img src="img/architecture/docs.jpg">

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### How to document?

<img src="img/architecture/lightweight-docs.jpg">

Don't make it a legal text - unless you really have to

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Architectural Decision Records (ADRs)

_Can work as an example for concise documentation_

- Put in the tools the developer use
- Make a decision, but make it educated, discuss before
- Who did you consult with?	
- Might get a little bit long and too formal in practice
- But at least is recognized broadly

https://adr.github.io/
<br>
https://www.redhat.com/architect/architecture-decision-records
<br>
https://github.com/joelparkerhenderson/architecture-decision-record/blob/main/templates/decision-record-template-by-michael-nygard/index.md
	</textarea>
</section>


<section data-markdown>
	<textarea data-template>
### Ubiquitous Language

- people generally agree that using the same word for the same thing is a good idea
- made popular by the domain driven design community

https://www.domainlanguage.com/wp-content/uploads/2016/05/DDD_Reference_2015-03.pdf

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Diagrams

- Pretty much anything that works
  - Whiteboard is fine
- UML often does not work
  - seen as too formal
  - too time consuming
- Four levels of abstraction tries to help here
  - https://c4model.com
  - often seen without a whole lot of a benefit

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
<!-- ### Real Talk: you will fuck it up anyway, just deal with it -->
### Real Talk: you will not get it right anyway, just deal with it
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Hanna
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Challenges
### Typical things happening in production

1. Smartass Lawyer Attack
1. Price comparison service tries to outsmart you
1. Hacker Attack
1. CEO rampage
1. Drift
1. Investigative Journalism
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 1: Smartass Lawyer Attack

_Can you explain your decision?_

- A lawyer gets bad conditions for the insurance
- The GDPR gives them the right for an explanation
- Can you provide such an explanation?

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 2: Attempted Manipulation / Adversarial Attacks

_Can a price comparison service outsmart you?_


Certain inputs may intentionally cause a grossly incorrect prediction to be made
* Can be used to systematically manipulate the output of the system
* How sensible a system is to such an attempt is determined by the inner complexity of such a system
  * often directly contradicting properties like explainability

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 3: Hacker Attack

_Can hackers get access to customer data?_

People get access to you production servers
- This is bad all by itself
- Getting access to raw customer data (required for density based KNN) is a disaster, though

<!--#### Lessons Learned
- some properties of systems require a technical level of understanding 
- looking at charts and high level check boxes are typically not sufficient
- as an architect you need to understand the technology used or partner with a dev role you trust-->
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 4: CEO rampage

_Can you defend your solution?_

CEO claims your solution is subpar and wants to hire big consultancy to replace your solution
- Trigger: her wife received a bad score
- Why does it make mistakes?
- Says it uses too much resources as well

<!--#### Lessons Learned
- properly documenting decision can have your back
- making honest and best solution without ego can safe your project-->

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 5: Drift

_Can you keep up with an ever changing world?_	

Driver assistance becomes prevalent
- Prediction of risk is no longer valid
- You need to update your model but should not have to rewrite it completely
- Are you able to create a stable new model?


	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Challenge 6: Investigative Journalism

_Can you deal with making imperfect decisions?_	

Claims there is systematic age bias
- You might have to get rid of that feature even though it might be really predictive
- KNN might become useless after that

<!--#### Lessons Learned
- you can not look into the future
- even with due diligence there will always be events that mess with your solution
- use documentation to cover your back (if necessary)
- act quickly without ego to fix problem-->

	</textarea>
</section>


<section data-markdown class="fragments" style="font-size: xx-large;">
	<textarea data-template>
## Hands-On: Discuss in your team

_How would each of these events affect your decision?_
- Go through each challenge
- Does the documentation help?
- What assumptions have been invalidated?
- Do you still think you made a good decision?
- If not, would you revise your choice?
- How would you argue for a change in architecture?

### 30 Minutes
</textarea>
</section>

<section data-markdown style="font-size: x-large;">
	<textarea data-template>
# Overview for hands-on

<div class="container">
	<div class="col">

## Challenges

1. *Smartass Lawyer Attack* - Can you explain your decision?
1. *Attempted Manipulation* - Can a price comparison service outsmart you?
1. *Hacker Attack* - Can hackers get access to customer data?
1. *CEO rampage* - Can you defend your solution?
1. *Drift* - Can you keep up with an ever changing world?
1. *Investigative Journalism* - Can you deal with making imperfect decisions?

	</div>
	<div class="col">
		
## Discuss for each challenge
- Does it have an effect on your decision?
- Does your documentation help?
- Were your assumptions right?
- Still a good choice?
- Or would you change it? How?
	
</div>
</div>

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Olli
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
## Reflection

### Share your major insights (if there are any)
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# What else?		
	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### You don't just deploy the model 

<img src="img/mlops/ml-system.jpg" style="height: 550px;">

<!-- <small>preprocessing, fallbacks, and ensembles -->

</small>

</textarea>
</section>

<section data-markdown="">
	<textarea data-template>
### What is the business objective?

- What do you want to achieve?
- How good does the solution need to be to fulfill this?
- How will the impact transform your business?

https://www.impactmapping.org/
<br>
https://www.impactmapping.org/example.html
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Conclusion

* Architecture can be defined as the sum of important decisions
* How to implement business logic is mostly one of those decisions
* If so, Machine Learning (ML) can be one option
* Among ML there are many different algorithms
* Which one is the best depends on the requirements
* Assumptions, requirements, and possible solutions can change over time
	</textarea>
</section>


<section data-markdown>
	<textarea data-template>
### Takeaway

<img src="img/architecture/EinKopfVollerSoftwareArchitektur_1024x724.png">

https://www.embarc.de/kopf-voller-softwarearchitektur-begriffsbild/

	</textarea>
</section>


<section data-markdown>
	<textarea data-template>
# Vielen Dank
## Architektur eines Machine Learning Services

Bleibt gern im Kontakt

hanna.lueschow@openknowledge.de

oliver@zeigermann.de, https://www.linkedin.com/in/oliver-zeigermann-34989773/

Slides: https://bit.ly/mad-ml-2023
</textarea>
</section>

		</div>
	</div>

	<script src="reveal.js/dist/reveal.js"></script>
	<script src="lib/jquery.js"></script>
	<script>
		const printMode = window.location.search.match(/print-pdf/gi);
		const isLocal = window.location.hostname.indexOf('localhost') !== -1 ||
			window.location.hostname.indexOf('127.0.0.1') !== -1;
		const isPresentation = isLocal && !printMode;
		const isPublic = !isPresentation;

		$('.hide').remove();

		if (isPresentation) {
		} else {
			// only applies to public version
			$('.todo').remove();
			$('.preparation').remove();
			$('.local').remove();
		}

		Reveal.addEventListener('ready', function (event) {
			// applies to all versions
			$('code').addClass('line-numbers');

			$('.fragments li').addClass('fragment')

			// make all links open in new tab
			$('a').attr('target', '_blank')

			if (isPresentation) {
				// only applies to presentation version
				Reveal.configure({ controls: false });
			} else {
				// only applies to public version
				$('.fragment').removeClass('fragment');
			}

			// we do not like fragments
			// $('.fragment').removeClass('fragment');

		});

	</script>

	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,
			controls: true,
			progress: true,
			history: true,
			center: true,
			width: 1100,
			slideNumber: true,
			hideInactiveCursor: false,
			transition: 'none', // none/fade/slide/convex/concave/zoom


			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>


</body>

</html>