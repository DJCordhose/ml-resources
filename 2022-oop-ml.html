<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>OOP - Machine Learning betrachtet als ein Engineering Problem</title>

		<link rel="stylesheet" href="reveal.js/dist/reset.css">
		<link rel="stylesheet" href="reveal.js/dist/reveal.css">
		<!-- <link rel="stylesheet" href="reveal.js/dist/theme/black.css"> -->
		<link rel="stylesheet" href="reveal.js/dist/theme/white.css">

		<!-- Theme used for syntax highlighted code -->
		<!-- <link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css"> -->
		<link rel="stylesheet" href="reveal.js/plugin/highlight/zenburn.css">
		<style>
			.right-img {
				margin-left: 10px !important;
				float: right;
				height: 500px;
			}
			.todo:before {
				content: 'TODO: ';
			}
			.todo {
				color: red !important;
			}
			code span.line-number {
				color: lightcoral;
			}
			.reveal pre code {
				max-height: 1000px !important;
			}
	
			img {
				border: 0 !important;
				box-shadow:0 0 0 0 !important;
				height: 450px;
			}
	
			.reveal {
				-ms-touch-action: auto !important;
				touch-action: auto !important;
					}

			  .reveal h1,
			  .reveal h2,
			  .reveal h3,
			  .reveal h4  {
					  /* letter-spacing: 2px; */
					  font-family: 'Calibri', sans-serif;
						/* font-family: 'Times New Roman', Times, serif; */
						/* font-weight: bold; */
						color: black;
						/* font-style: italic; */
						/* letter-spacing: -2px; */
						text-transform: none !important;
					}
	
					.reveal em {
						font-weight: bold;
					}
	
			.reveal section img {
			  background: none;
			}
	
					.reveal img.with-border {
						border: 1px solid #586e75 !important;
						box-shadow: 3px 3px 1px rgba(0, 0, 0, 0.15) !important;
					}
	
					.reveal li {
						margin-bottom: 8px;
					}
	
					/* For li's that use FontAwesome icons as bullet-point */
				.reveal ul.fa-ul li {
					list-style-type: none;
				}

		  .reveal {
			  /* font-family: 'Work Sans', 'Calibri'; */
			  font-family: 'Calibri';
			  color: black !important;
			  font-size: xx-large;
		   }

		   .container {
			  display: flex;
		  }
		  .col, col-1 {
			  flex: 1;
		  }

		  .col-2 {
			  flex: 2;
		  }

		</style>

	</head>
	<body style="background-color: whitesmoke;">
		<div class="reveal">
			<div class="slides">

<section class="local hide">

	<p>Machine Learning wird häufig immer noch als eine mathematische Herausforderung angesehen und an den Universitäten
		meist ebenso gelehrt. Es regt sich aber auch im akademischen Umfeld Widerstand und selbst Stars wie Andrew Ng
		bieten neuerdings Kurse mit Inhalten an, die uns Softwareentwickeln eher vertraut sind.<br> In diesem Talk werde
		ich beleuchten, wie viel man wirklich wissen muss, um als Softwareentwickler Machine Learning sinnvoll
		einzusetzen.</p>
	<p><strong>Zielpublikum:</strong> Jede Rolle im Bereich Softwareentwicklung<br><strong>Voraussetzungen:</strong>
		Verständnis von Softwareentwicklung, kein Verständnis von ML notwendig<br><strong>Schwierigkeitsgrad:</strong>
		Anfänger</p>
	<p><strong>Extended Abstract</strong><br> Machine Learning Verfahren im allgemeinen und Neuronale Netzwerke im
		speziellen erfordern für ihr tiefes Verständnis Kenntnisse im Bereich der Linearen Algebra, der Analysis und der
		Statistik.<br> Aber: Als Softwareentwickler implementiert man Neuronale Netzwerke typischerweise nicht auf der
		grünen Wiese und kommt auch nicht in die Verlegenheit, komplexe Netzwerke selbst aufzubauen. Viel häufiger
		kommen Frameworks wie TensorFlow und sogar komplett aufgebaute und zum Teil schon trainierte Neuronale Netzwerke
		zum Einsatz.<br> Das verschiebt die Problematik des Machine Learnings in die Richtung des Engineerings:</p>
	<ul>
		<li>Wie baut man eine Trainings-Pipeline auf?</li>
		<li>Wie bekommt man das trainierte Modell in Produktion und sorgt dann dafür, dass das Modell weiterhin aktuell
			bleibt?</li>
	</ul>
</section>

<section data-markdown>
    <textarea data-template>
## Machine Learning betrachtet als ein Engineering Problem                

OOP 2022, https://www.oop-konferenz.de/oop-2022/programm/konferenzprogramm#item-3307

Oliver Zeigermann / oliver@zeigermann.de

Folien: https://bit.ly/2022-oop-ml

    </textarea>
</section>

<section data-markdown class="todo">
* Struktur
  * Fluss allgemein
* Notebooks	
  * Notebook 3 mit den herausgezogenen Libs
  * Notebook 1 und 2 lokal lauffähig machen
* Skizzen
  * auswählen
  * zoomen
  * besser malen am Tablet
</section>

<section data-markdown>
<textarea data-template>
### Wer ist Olli

<div style="display: flex;">
    <div style="flex: 50%;">
        <a href='https://oreilly.de/produkt/machine-learning-kurz-gut-2/'>
        <img src='img/ml-buch-v2.jpg' height="400">
        </a>
    </div>
    <div style="flex: 50%; font-size: x-large;">
        <img src='img/olli-opa.jpeg'>
    </div>
</div>
<p>
    <a target="_blank" href="mailto:OliverZeigermann@gmail.com">Oliver Zeigermann</a>:
Entwickler, Architekt, Berater und Coach für Machine Learning
</p>    
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Wieso dieser Talk und wieso so?

* Was kann man schon machen in einem Talk?
* Einblick in meine Welt zwischen ML und Dev
* Möglichst realistisch und anschaulich	
	</textarea>
</section>

<section data-markdown class="todo">

David Krueger (@DavidSKrueger) twitterte um 0:45 PM on Sa., Jan. 29, 2022:
Machine Learning lives in an uncanny valley btw Science and Engineering.

It's the worst of both worlds.

We don't care about understanding, just making things "work" (bad science).

We don't care if things work in the real world, just on  contrived benchmarks (bad engineering).
(https://twitter.com/DavidSKrueger/status/1487391569028296710?t=cmgiSKFld_ZnJenHYlsEmQ&s=03) 
</section>

<section data-markdown>
	<textarea data-template>

### Was muss man für ML können?	

<img src='img/role-ml-engineer.png' style="height: 400px">

Da steht nichts von Mathematik oder Verständnis wie ein neuronales Netz funktioniert.

https://boards.greenhouse.io/openai/jobs/4050138004
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Agenda

* Phase 1: Exploration
* Phase 2: Professionalisierung
* Phase 3: Produktion

	</textarea>
</section>

<section data-markdown>
    <textarea data-template>
## Unser Beispiel: Vorhersage von Risiken

* Wir sind CTO einer hochinnovativen Kfz-Versicherungsgesellschaft
* Anders als andere Versicherungsgesellschaften bestimmen wir den Tarif anhand der geschätzen Anzahl von Unfällen pro Kunde
* Zielsetzung: Wie viele Unfälle werden die potenziellen Kunden haben?

<img src='img/pixabay/accident-151668_1280.png' style="height: 230px">
    </textarea>
</section>

<section>
<h3>Klassifizierung basierend auf bekannten Daten</h3>
<img src="img/insurance-new/train-data.png" height="500px" class="fragment">
</section>


<section data-markdown>
<textarea data-template>
### Vorhersage von Risiken für potenzielle Kunden

<a href='html/calculator.html'>
<img src='img/calculator.png' height="400">
</a>
<p><small>
<a href='html/calculator.html' target="_blank">
https://embarced.github.io/ml-concepts/html/calculator.html</a></small>
</small></p>
</textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Agenda

* Phase 1: _Exploration_
* Phase 2: Professionalisierung
* Phase 3: Produktion

	</textarea>
</section>

<section data-markdown class="fragments">
### Phase 1: Exploration

* in der ersten Phase eines Machine Learning Projekts wird die Anwendungsidee validiert und ein funktionsfähiges Modell entwickelt.
* dabei ist ein schnelles iterieren und ausprobieren von Ideen zentral
* das Ziel ist *nicht* ein sinnvolles Stück Software
* Scripting passt hier besser als Programmieren als Ausdruck für die Tätigkeit
* das Ziel ist eine schnelle Entwicklung
* Phase 1 endet entweder mit  
  * einem funktionsfähigen Modell mit dem man in Phase II übergeht oder
  * dem verwerfen des Ansatzes 

</section>

<section data-markdown>
### Man muss sein Problem so formulieren, dass es für ML greifbar wird

<img src='img/software-complexity.png'>

<small>
Andrej Karpathy - TRAIN AI 2018 - Building the Software 2.0 Stack

https://vimeo.com/272696002

</small>
</textarea>
</section>


</section>

<!-- <section data-markdown>
    <textarea data-template>
### Literate Statistical Programming

1. Intent
1. Code
1. Data
1. Results
1. (Interpretation)

_Idee implemented in so called "notebooks"_

<small>https://en.wikipedia.org/wiki/Literate_programming</small>
<br>
<small>https://education.arcus.chop.edu/literate-statistical-programming/</small>

</textarea>
</section> -->

<section data-markdown style="font-size: x-large;">
    <textarea data-template>
## Schritt \#1 - Live Coding - Notebooks, interaktive Skripte

### Wie fühlt sich Arbeit in Notebooks an?

https://colab.research.google.com/github/DJCordhose/ml-resources/blob/main/notebooks/mlops/1_mlops_train.ipynb
</textarea>
</section>

<section data-markdown style="font-size: x-large;">
    <textarea data-template>
## Schritt \#2 - Live Coding

### Wir bringen unser Modell in Produktion

https://colab.research.google.com/github/DJCordhose/ml-resources/blob/main/notebooks/mlops/2_mlops_serve.ipynb
</textarea>
</section>

<section data-markdown>
    <textarea data-template>
# Fertig!

</textarea>
</section>

<section data-markdown>
    <textarea data-template>
## Daten passen prima zu der Vorhersage

<img src='img/insurance-new/insurance-pred.png' class="fragment">

</textarea>
</section>

<section data-markdown>
    <textarea data-template>
# Oder?

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Kann man sinnvoll direkt in Produktion gehen?

<img src='img/sketch/phases.png'>
    </textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Phase I hinterlässt gern einen Wust an Notebooks

<img src='img/sketch/decoupling-notebooks.jpg'>

* das ist kein Zeichen von einem unprofessionellen Vorgehen
* ergibt sich aus der Arbeitsweise und Zielsetzung
* jeder Experimentator, erprobte ML Ansatz und jede Iteration kann eine neue, komplett entkoppelte Kopie eines Notebooks rechtfertigen
* natürlich wird dabei teilweise falsch entkoppelt
  * Wir kopieren alles, auch die Teile, die die beiden Notebooks größtenteils unverändert teilen
  * Solange wir aber nicht wissen was die relevant gemeinsamen Teile sind müssen wir damit weiter machen
* ob ein bestimmter Ansatz mehr Liebe verdient wird erst am Ende dieser Phase klar
    </textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Agenda

* Phase 1: Exploration
* Phase 2: _Professionalisierung_
* Phase 3: Produktion

	</textarea>
</section>

<section data-markdown class="fragments">
### Phase 2: Professionalisierung

* in der zweiten Phase wird die skizzierte Lösung in ein langlebiges Projekt umgewandelt
* alle Regeln einer guten Software-Entwicklung gelten von nun an
* Stabilität und Funktionalität wird gewährleistet
* Die Rahmenbedingungen der Produktionsumgebung müssen erfüllt werden
  * Art des Deployments, Sprache, Latenz, Speicher, Bandbreite, etc.
* Phase II endet entweder mit  
  * reifem Code und Modell mit dem man in Phase III übergeht oder
  * dem iterieren zurück in Phase I mit neu gewonnenen Erkenntnissen oder falls Anforderungen nicht erfüllt werden

</section>


<section data-markdown class="todo">
	<textarea data-template>
<img src='img/sketch/python-ml-workflow-2.png'>
    </textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Was gehört in Bibliotheken ausgelagert?

* Wir können nicht mit einem Notebook in Produktion gehen
  * also muss alles was wir in Produktion brauchen aus den Notebooks herausgezogen werden
* Bestimmte Teile eines Notebooks haben sich als stabil herausgestellt und 
  * sollten nicht bei jeder Kopie entkoppelt werden
* Alles was sich nach Software anfühlt (Klassen, Funktionen, etc.) ist auch Software
  * diese Teile sollten auch wie solche behandelt werden  
    </textarea>
</section>

<section data-markdown>
	<textarea data-template>
# Agenda

* Phase 1: Exploration
* Phase 2: Professionalisierung
* _Phase 3: Produktion_

	</textarea>
</section>

<section data-markdown>
	<textarea data-template>
<img src='img/everybody-gansta.png' style="height: 600px">

<small>

https://twitter.com/karpathy/status/1486215976559398915
</small>

</textarea>
</section>


<section data-markdown class="fragments">
### Phase 3: Produktion

* in der dritten Phase wird die Lösung in Betrieb genommen
* alle Regeln des produktiven Einsatzes von Software gelten auch hier
* Monitoring hat zusätzliche Herausforderungen
  * Natur und Verteilung der Anfragen und auch Vorhersagen muss permanent überwacht werden
* Phase III endet entweder mit  
  * der Abschaltung
  * dem iterieren zurück in Phase II mit neu gewonnenen Erkenntnissen
  * dem iterieren zurück in Phase I mit neu gewonnenen Erkenntnissen oder einem Neuansatz

</section>

<section data-markdown>
### Was ist MLOps?

_MLOps is a set of practices used to deploy and maintain machine learning models in production._

<!-- In layman terms, MLOps covers everything that comes after model building. After a model is trained and evaluated, it is
ready for end-use. It can then make predictions on new user data entering the system. -->


https://towardsdatascience.com/the-mlops-engineer-role-a-gentle-introduction-8d94cdc73904
</section>

<section data-markdown class="fragments">
### Warum MLOps?

* im akademischen Leben zählt für einen Wettbewerb häufig nur der Score (Güte) des Modells
<!-- * dieser Ansatz hat sich im Bereich des Data Science auch in der Praxis breit gemacht -->
* die Praxis ist aber keine Kaggle Competition
* In-Sample Evaluation (auch wenn wir die vorher abgetrennt haben) sagt nur bedingt etwas für Eignung in einer praktsichen Anwendung aus
* Out-Of-Sample Evaluation häufig erst im produktiven Betrieb möglich (evtl nur mitlaufen lassen)
</section>

<section data-markdown>
	<textarea data-template>
### Eine ML Lösung hat 2 Artefakte: Code und Modell		

* Beides muss in Prod gebracht werden
* Daten und Modell muss extern gehalten, aber zusammen mit Code versioniert werden
* Modell beschreibt einen Ausschnitt der Realität. Wie finde ich heraus wie gut es das tut uns vor allem für relevante Teile der Welt und was mache ich wenn sich das ändert
* Richtung: Benchmark und Monitoring der Lösung in Produktion
* Prod geht auf Code und Modell Binaries, Modell Graph überall ausführen

</textarea>
</section>

<section data-markdown>
	<textarea data-template>
### Nicht aller Code ist für Produktion gedacht		

* Was geht in Produktion
  * Vorhersage
  * Monitoring

* Was geht nicht in Produktion
 * Training
 * Analytics
 * Visualisierung


</textarea>
</section>

<section data-markdown class="fragments todo">
    <textarea data-template>
### Probleme: Selection/Survivor Bias

* Wir können nicht aktiv Daten sammeln, sondern nur von unseren Kunden
* Wir haben keine explizite Kontrolle darüber, wer bei uns versichert werden will und wessen Unfalldaten wir bekommen
* Es gibt aber eine Tendenz dahin, dasss eher Kunden mit guten Konditionen kommen
* Mögliche Lösung: ab und zu risikoreichen Personen gute Angebote machen
* Neues Problem: potentielle Nachvollziehbarkeit

https://en.wikipedia.org/wiki/Survivorship_bias
</textarea>
</section>

<section data-markdown class="fragments todo" style="font-size: x-large;">
### Phase 3: Betrieb

* Schwierigkeit: 
  * Müssen wir wieder zurück ins Experiment?
  * Wie finden wir heraus, ob unser Modell gut funktioniert?

* Monitoring
  * Alles was man auch sonst monitort
  * Plus Anfragen sammeln und Vorhersagen mitschreiben
    
* Achtung Bias
  * Wenn wir nur die vermeintlich guten Kunden annehmen, wie können wir dann einen schlechten erkenen?
  * wir haben ja gar keinen oder nur wenige als Kunden
  * Einen gewissen Prozentsatz mit schlechter Hypothese ein sehr gutes Angebot machen

</section>

<section data-markdown class="todo">

- Information über Schadensfälle neuer Kunden kommen nur verzögert
- Aber neue Meldungen über Schandensmeldungen kommen permanent
  - wie oft neu trainieren?
  - mit welchen Daten? Aktualität vs Datenmenge?
  - wie schnell ändert sich die Welt? wie schnell die Menschen die bei uns Kunden sein wollen?
  - Datensätze schnell statistisch vergleichen mit describe
</section>


<section data-markdown>
    <textarea data-template>

<img src='img/6monts-later.jpg' height="600px">

</textarea>
</section>

<section data-markdown class="fragments">
    <textarea data-template>
### Wir haben das System ein bisschen in Produktion laufen lassen

Mal sehen wie sich das System macht

- Information über Schadensfälle neuer Kunden kommen nur verzögert
- Aber neue Meldungen über Schandensmeldungen kommen permanent
- Wir haben keine explizite Kontrolle darüber, wer bei uns versichert werden will und wessen Unfalldaten wir bekommen
- Es gibt aber eine Tendenz dahin, dasss eher Kunden mit guten Konditionen kommen

<small>

https://colab.research.google.com/github/DJCordhose/ml-resources/blob/main/notebooks/mlops/3_mlops_shift.ipynb
</small>

</textarea>
</section>


<section data-markdown>
    <textarea data-template>
## Ergebnis des Modells nach einem halben Jahr

<img src='img/insurance-new/insurance-after-shift.png' class="fragment">

</textarea>
</section>


<section data-markdown>
    <textarea data-template>
## Ursprüngliche Daten zum direkten Vergleich

<img src='img/insurance-new/insurance-pred.png'>

</textarea>
</section>

<section data-markdown class="fragments">
    <textarea data-template>
### Was ist hier passiert? 

*Die Welt steht nicht still - Model und Welt laufen auseinander, aus 70%  Genauigkeit werden 65%*

* Elektroautos finden weitere Verbreitung
* potente Elektroautos haben allgemein deutlich geringere Höchstgeschwindigkeit 
  * aber super Beschleunigung
* Gute Beschleunigung ist viel eher Ursache für rasante Fahrweise, Unfallwahrscheinlichkeit ist hoch
* Wir haben aber nur Höchstgeschwindigkeit als Daten (seht im Fahrzeugschein), Korrelation war angenommen
* Der Cluster mit jungen, schlechten Fahrern ist nach unten gerutscht
* _Wird nun fälschlich als gut vorhergesagt und werden günstig versichert_
<!-- * Tatsächlich sehen wir aber viele Unfälle -->
<!-- - Faherer vielleicht ein bisschen älter geworden -->
</textarea>
</section>

<section data-markdown>
    <textarea data-template>
### Prozess eines ML-Projekts

<img src='img/sketch/phases.png' style="height: 100%;">    
</textarea>
</section>


 <section data-markdown>
    <textarea data-template>
### Wieso MLOps oder warum ist ein Modell nie wirklich fertig

_Concept und Data Drift_
- Vorhersagen werden ohne Nachtraining schlechter 
- die Welt entwickelt sich weiter und liefert andere Daten

_Passiert_
- plötzlich (neue oder veränderte Konkurrenten, schwerwiegende Ereignisse) oder
- schleichend (gesellschaftliche Entwicklungen)

unterschiedliche Abschnitte der Daten können unterschiedlich schnell vergammeln

<small>

https://en.wikipedia.org/wiki/Concept_drift
<br>
https://twitter.com/chipro/status/1313921889061015557

</small>
    </textarea>
</section>

<section data-markdown class="fragments">
    <textarea data-template>
### Woher weiß man, dass das Modell neu trainiert werden sollte?

1. Mindestens einmal im Jahr, damit man überhaupt noch weiß wie es geht
1. Wenn die Metrik des Modells nachlässt in Produktion
   1. Dafür braucht man die Ground Truth der Daten aus Produktion
   1. Manchmal bekommt man diese unmittelbar nach der Vorhersage durch die Reaktion eines menschlichen Benutzers
   1. Oft aber auch erst nach nennenswerter Verzögerung 
1. Wenn sich die Verteilung der Daten der Anfragen deutlich von denen des Trainings unterscheiden 

</textarea>
</section>

<section data-markdown class="fragments">
    <textarea data-template>
### Wie gehen wir zurück in die Phasen I und II

* hier wird wieder in Notebooks gearbeitet
* die Bibliotheken werden inkludiert und bei jeder Änderung neu geladen
* Jupyter Lab bietet eine gemeine Oberfläche für Notebooks und Bibliotheken
* Eine Kombination von Visual Studio Code und Jupyer Notebooks ist ebenso möglich
* Selbst Colab erlaubt das Arbeiten auf einer Kombination von Notebooks und Bibliotheken

</textarea>
</section>


<section data-markdown>
	<textarea data-template>
### Referenz: Module in Colab nutzen

https://colab.research.google.com/drive/1hDUO1-EzMVtVt6snmgrR1I1A36oPp4J9#scrollTo=V4ldP8_-cuZ9
</textarea>
</section>

<section data-markdown>
    <textarea data-template>
# Vielen Dank

Machine Learning betrachtet als ein Engineering Problem

OOP 2022, https://www.oop-konferenz.de/oop-2022/programm/konferenzprogramm#item-3307

Bleibt gern im Kontakt

oliver@zeigermann.de

https://twitter.com/DJCordhose

Diese Folien: https://bit.ly/2022-oop-ml

    </textarea>
</section>


			</div>
		</div>

		<script src="reveal.js/dist/reveal.js"></script>
		<script src="reveal.js/plugin/notes/notes.js"></script>
		<script src="reveal.js/plugin/markdown/markdown.js"></script>
		<script src="reveal.js/plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				controls: true,
				progress: true,
				history: true,
				center: true,
				width: 1100,
				slideNumber: true,
				hideInactiveCursor: false,


				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>

<script src="lib/jquery.js"></script>

<script>
	const printMode = window.location.search.match(/print-pdf/gi);
	const isLocal = window.location.hostname.indexOf('localhost') !== -1 || 
				window.location.hostname.indexOf('127.0.0.1') !== -1;
	const isPresentation = isLocal && !printMode;				
	const isPublic = !isPresentation;

	$('.hide').remove();

	if (isPresentation) {
	} else {
		// only applies to public version
			$('.todo').remove();
			$('.preparation').remove();
			$('.local').remove();
	}

	Reveal.addEventListener( 'ready', function( event ) {
		// applies to all versions
		$('code').addClass('line-numbers');

		$('.fragments li').addClass('fragment')

		// make all links open in new tab
		$('a').attr('target', '_blank')

		if (isPresentation) {
			// only applies to presentation version
			Reveal.configure({ controls: false });
		} else {
			// only applies to public version
			$('.fragment').removeClass('fragment');
		}

		// we do not like fragments
		// $('.fragment').removeClass('fragment');

	} );

</script>

	</body>
</html>
