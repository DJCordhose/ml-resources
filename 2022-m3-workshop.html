<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">

	<title>Entwicklungsprozess</title>

	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<!-- <link rel="stylesheet" href="reveal.js/dist/theme/black.css"> -->
	<link rel="stylesheet" href="reveal.js/dist/theme/white.css">

	<!-- Theme used for syntax highlighted code -->
	<!-- <link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css"> -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/zenburn.css">
	<style>
		.right-img {
			margin-left: 10px !important;
			float: right;
			height: 500px;
		}

		.todo:before {
			content: 'TODO: ';
		}

		.todo {
			color: red !important;
		}

		code span.line-number {
			color: lightcoral;
		}

		.reveal pre code {
			max-height: 1000px !important;
		}

		img {
			border: 0 !important;
			box-shadow: 0 0 0 0 !important;
			height: 450px;
		}

		.reveal {
			-ms-touch-action: auto !important;
			touch-action: auto !important;
		}

		.reveal h1,
		.reveal h2,
		.reveal h3,
		.reveal h4 {
			/* letter-spacing: 2px; */
			font-family: 'Calibri', sans-serif;
			/* font-family: 'Times New Roman', Times, serif; */
			/* font-weight: bold; */
			color: black;
			/* font-style: italic; */
			/* letter-spacing: -2px; */
			text-transform: none !important;
		}

		.reveal em {
			font-weight: bold;
		}

		.reveal section img {
			background: none;
		}

		.reveal img.with-border {
			border: 1px solid #586e75 !important;
			box-shadow: 3px 3px 1px rgba(0, 0, 0, 0.15) !important;
		}

		.reveal li {
			margin-bottom: 8px;
		}

		/* For li's that use FontAwesome icons as bullet-point */
		.reveal ul.fa-ul li {
			list-style-type: none;
		}

		.reveal {
			/* font-family: 'Work Sans', 'Calibri'; */
			font-family: 'Calibri';
			color: black !important;
			font-size: xx-large;
		}

		.container {
			display: flex;
		}

		.col,
		col-1 {
			flex: 1;
		}

		.col-2 {
			flex: 2;
		}
	</style>

</head>

<body style="background-color: whitesmoke;">
	<div class="reveal">
		<div class="slides">

<section data-markdown class="local preparation hide">
</section>

<section data-markdown class="todo">
	### The world is messy
		 
	 Statisticians that believe that doing the statistics is the hard part reveal they have no sense how messy real world data collection is.
	
	Hardest part is having a dataset that reflects reality. Time delays, simple dismissals, incentives, clerical errors, term ambiguity, on and on
	(https://twitter.com/normonics/status/1511021293969235975?t=spHs38A9j38gdGASJMt1AA&s=03) 
</section>
	
	

			<section data-markdown>
				<textarea data-template>
## MLOps mit Python und TensorFlow         
### Machine Learning betrachtet als ein Engineering Problem       

M3 2022, https://www.m3-konferenz.de/

<!-- Oliver Zeigermann / oliver@zeigermann.de -->

Oliver Zeigermann

Folien: https://bit.ly/xxx

    </textarea>
			</section>

<section data-markdown class="todo">

https://developers.google.com/machine-learning/guides/rules-of-ml			
</section>

<section data-markdown class="todo">
###	Hauptarbeit, Metric Server mit Grafana etc. bauen

* Können wir damit Alerts triggern?
  * https://evidentlyai.com/

</section>
	
<section data-markdown class="todo">


* conda install dazu: https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file
* https://github.com/ecosia/pycon22-prometheus-workshop
* Docker nutzen optional
* Unsere APP served einfach das Modell, aber wir kriegen auch Metrics über Anfragen und Antworten
  * einbauen, dass wir unsere Metriken wie Drift und so monitoren können
  * Alert einbauen bei irgendwas
</section>

<!-- 
M3 Workshop:

Titel: MLOps mit Python und TensorFlow
Untertitel: Machine Learning betrachtet als ein Engineering Problem

Level: Fortgeschritten

Eine praxistaugliche Anwendung mit Techniken des Machine Learnings zu entwickeln ist in erster Linie eine
Herausforderung im Bereich des Engineerings. Dabei geht es mehr um den
Entwicklungsprozess und weniger um die konkret eingesetzte Technik und
die Bibliotheken.

In diesem Workshop gehen wir gemeinsam durch die unterschiedlichen Phasen eines Machine Learning Projekts, von der
Exploration und Validierung eines Machine Learning Ansatzes über
die Professionalisierung zu einem stabilen Stück Software bis in den produktiven Einsatz. 

In der ersten Phase entwickeln wir eine Machine Learning basierte Lösung für ein gegebenes Problem.
Dabei iterieren wir mit der Hilfe von Notebooks schnell durch unterschiedliche Experimente. Am Ende dieser Phase haben
wir unsere Idee (hoffentlich) validiert und können
mit diesem Ansatz in die nächste Phase übergehen.

In Phase zwei professionalisieren wir unseren gefundenen Ansatz in Richtung Produktion. Dabei bringen wir unsere Experimente in 
Python Module und bereiten diese für die Produktion vor. In dieser letzten Phase der Produktion sehen wir uns an, wie man ein solches Modell betreiben und monitoren kann.

Alle Schritte sind hands-on und wir werden genug Zeit für Diskussionen haben. 

Vorkenntnisse

Teilnehmer sollten entweder mit den Werkzeugen und dem Vorgehen im Bereich Data Science und/oder als Machine Learning
Engineer grundlegende Erfahrung haben. Die Sprache Python ist ebenso Grundlage.
Die Werkzeuge sind von untergeordneter Bedeutung. Kenntnisse im Bereich TensorFlow oder Scikit-Learn, Jupyter Notebooks
und Colab erleichtern die Entwicklung jedoch.

Lernziel

In diesem durch praktische Übungen geprägten Workshop wollen wir zusammen die Herausforderungen kennen lernen und
meistern, die sich aus dem Ziel "langfristig in Produktion" sein ergeben.


Kurzbeschreibung für M3

Eine praxistaugliche Anwendung mit Techniken des Machine Learnings zu entwickeln ist in erster Linie eine
Herausforderung im Bereich des Engineerings.

In diesem Workshop gehen wir gemeinsam durch die unterschiedlichen Phasen eines Machine Learning Projekts, von der
Exploration und Validierung eines Machine Learning Ansatzes über
die Professionalisierung zu einem stabilen Stück Software bis in den produktiven Einsatz. Dabei geht es mehr um den
Entwicklungsprozess und weniger um die konkret eingesetzte Technik und
die Bibliotheken.

Vorbereitung

Dieser Workshop geht davon aus, dass du bereits eine Entwicklungsumgebung mit IDE, Python Distribution und Git auf eurem Rechner lauffähig hast. 
Sollte das nicht der Fall sein und du nicht sicher bist, welche Software passt, installiere bitte:
1. Anaconda: https://www.anaconda.com/products/individual
2. Visual Studio Code: https://code.visualstudio.com/
3. Git: https://git-scm.com/downloads

Wir werden auf einem Beispielprojekt arbeiten. Habt bitte bereits vor dem Workshop
1. Das Projekt geklont: https://github.com/DJCordhose/insurance-ml
2. ein neues Environment erzeugt, mit Anaconda ginge das mit (https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html): 
  * conda create --name insurance-ml --clone base
  * conda activate insurance-ml
3. weitere Abhängigkeiten installiert mittels: pip install -r requirements.txt

Agenda

09:00 Uhr: Beginn

Einführung in das Projekt und Überblick
* Grundlagen von ML
* Phasen eines ML Projekts
* Unser Beispiel erkunden
* TensorFlow und Scikit-Learn

10:45 - 11:00 Uhr: Kaffeepause

Phase I: Exploration
* Was ist der Sinn dieser Phase, was sind die Ziele
* Wieso bauen wir hier keine "richtige" Software?
* Arbeit mit Notebooks und Colab
* Übergang zu Phase II 

12:30 - 13:30 Uhr: Mittagspause

Phase II: Professionalisierung
* Vom Notebook zum Modul
* Vom Notebook zum Script
* Testing mit Python Unit testing
* Finden von Fehlern und Debugging
* Was muss man dokumentieren?
* Arbeit in der IDE
* Übergang zu Phase III oder I

15:00 - 15:15 Uhr: Kaffeepause

Phase III: Produktion
* Optionen für Produktivsetzung und Integration
* Drifts und Monitoring
* TFX
* Übergang zu Phase II oder I

ca. 17:00 Uhr: Ende

Übungen
* Phase II
  * Diskussion in der Gruppe: wo sollte man was dokumentieren?
    * Dann mit allen besprechen, dann umsetzen
 -->

 <section data-markdown>
	<textarea data-template>
## Monitoring
	</textarea>
</section>

<section data-markdown class="todo">
### Grundregel

* Alle haben Probleme in Produktion
* Es gibt kein fehlerfreies System 
  * jedenfalls nicht für lange
* Ziel ist es, Fehler schnell 
  * zu entdecken,
  * zu analysieren
  * und entsprechende ihrer schwere zu adressieren

</section>
	

<section data-markdown class="todo">
### Die vier goldenen Regeln des traditionellen Monitorings
* 
	https://sre.google/sre-book/monitoring-distributed-systems/	
</section>

<section data-markdown>
## Welche Metriken kann man in ML Systemen überwachen?

Entscheidend ist die Performance des Systems

* Technische Metriken
  * ohnehin verfügbar, weil für das Training erforderlich
  * accuracy, precision/recall 
* Business Metriken
  * z.B.
	* Umsatz / Gewinn
	* Umfang Schadensmeldungen
    * allgemeiner Käufe, Views, Clicks, etc.
  * oft sinnvoller, aber schwerer zu messen oder schwerer zu quantifizieren

</section>

<section data-markdown>
## Das reicht meist nicht

* Ground Truth liegt erst sehr spät vor
  * Ob jemand ein guter Kunde ist wissen wir oft erst nach Jahren
* Manchmal liegt die Ground Truth überhaupt nicht vor
* Filter Bubble: es werden nur bestimmte Daten gesammelt
  * wir sammeln nur Daten von Leuten, die auch unsere Kunden werden   
* Unterschiedliche Teilbereiche können eine unterschiedliche Performanz haben
  * Während ein Bereich besser wird, kann ein anderer, evtl. kleinerer Bereich deutlich schlechter werden, bei gleichbleibenden Performance
* Performance kann stark über die Zeit variieren
  * anhängig von der Art der Anfragen
  * manchmal mit Regelmäßigkeiten innerhalb eines Tages
  * Trend in Abweichungen manchmal schwer zu bestimmen   
</section>


<section data-markdown>
	<textarea data-template>
### Monitoring für ML muss komplexer sein

<img src="img/google-ml-monitoring.png">


Long: https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/aad9f93b86b7addfea4c419b9100c6cdd26cacea.pdf
Short: https://storage.googleapis.com/pub-tools-public-publication-data/pdf/45742.pdf
</textarea>
</section>

<section data-markdown>
## Was kann man machen: Frühes Monitoring

* Qualität der Daten
  * wie verändern sich fehlende oder falsche Felder
  * Plausibilität
* Daten Drift
  * Verteilung der Eingabedaten
* Prediction Drift   
  * Was gibt das Modell aus?
</section>

<section data-markdown>
## Datenqualität

* Felder
  * fehlen
  * ungültig
  * falsch / unplausibel / Wertebereich verlassen
* Features 
  * konstante (die (meisten) Eingaben haben (fast) denselben Wert)
  * leere
  * fast leer
  * Korrelationen zwischen Features
</section>
	
<section data-markdown>
## Drift Detection
</section>

<section data-markdown>
## Metriken für Drift 

* Wie viele Predictions sind gültig bzw. werden als gut genug angesehen?
* Art der Verteilung (z.B. Normal)
* Parameter einer angenommenen Normalverteilung
  * Mean
  * Std Dev
  * Percentile
  * min-max
* Statistische Tests für Konfidenzintervalle
  * KL Divergence
  * Kolmogorow-Smirnow-Test  	
</section>


<section data-markdown >
	<textarea data-template>
## Drift erfordert Interpretation

Wenn die Welt sich ändert, ist Drift zu erwarten und damit ok

|   | Positive Interpretation, keine Maßnahme erforderlich  | Negative Interpretation, Maßnahme erforderlich  |
|---|---|---|
| *Data und Prediction Drift*  | wichtige Features haben geändert, Modell kommt klar und extrapoliert gut, z.B.: Höheres Alter, mehr Risiko  |  wichtige Features haben geändert, Modell extrapoliert nicht sinnvoll |
| *Data aber kein Prediction Drift*  | keine wichtigen Features geändert, das Modell ist robust genug für den Drift  | wichtige Features geändert, Modell extrapoliert nicht sinnvoll |
|   |   |   |

</textarea>
</section>

<section data-markdown>
## Maßnahmen bei Drift
* Neue Daten aufnehmen (und labeln)
* Neue Version des Modells trainieren
* Schnelle Maßnahme
  * Pre-/Post-Processing des Modells neu kalibrieren
  * Schwellwerte für Anwendung anpassen
  * Bestimmte Bereiche ausklammern 
  * Modell Architektur ändern (oder fixen) und neu trainieren
* Sehr schnelle Maßnahme: Fallback
  * Manuell
  * Heuristik / Baseline


</section>



<section data-markdown class="todo">
### Grafana
	
 https://play.grafana.org/
</section>

<section data-markdown class="todo">
### Prometheus

* https://prometheus.io/
* https://prometheus.io/docs/prometheus/latest/getting_started/
  * https://prometheus.io/download/

</section>


			<section data-markdown>
				<textarea data-template>
# Vielen Dank

MLOps mit Python und TensorFlow
Machine Learning betrachtet als ein Engineering Problem

OOP 2022, https://www.oop-konferenz.de/oop-2022/programm/konferenzprogramm#item-3307

Bleibt gern im Kontakt

Oliver Zeigermann

https://www.linkedin.com/in/oliver-zeigermann-34989773/

<!-- oliver@zeigermann.de -->

https://twitter.com/DJCordhose

Diese Folien: https://bit.ly/2022-oop-ml

    </textarea>
			</section>


		</div>
	</div>

	<script src="reveal.js/dist/reveal.js"></script>
	<script src="lib/jquery.js"></script>
	<script>
		const printMode = window.location.search.match(/print-pdf/gi);
		const isLocal = window.location.hostname.indexOf('localhost') !== -1 ||
			window.location.hostname.indexOf('127.0.0.1') !== -1;
		const isPresentation = isLocal && !printMode;
		const isPublic = !isPresentation;

		$('.hide').remove();

		if (isPresentation) {
		} else {
			// only applies to public version
			$('.todo').remove();
			$('.preparation').remove();
			$('.local').remove();
		}

		Reveal.addEventListener('ready', function (event) {
			// applies to all versions
			$('code').addClass('line-numbers');

			$('.fragments li').addClass('fragment')

			// make all links open in new tab
			$('a').attr('target', '_blank')

			if (isPresentation) {
				// only applies to presentation version
				Reveal.configure({ controls: false });
			} else {
				// only applies to public version
				$('.fragment').removeClass('fragment');
			}

			// we do not like fragments
			// $('.fragment').removeClass('fragment');

		});

	</script>

	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,
			controls: true,
			progress: true,
			history: true,
			center: true,
			width: 1100,
			slideNumber: true,
			hideInactiveCursor: false,


			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>


</body>

</html>